# Customer Churn Prediction API with Comprehensive Testing

This project provides a production-ready, containerized API for serving a customer churn prediction model. Built with FastAPI, it demonstrates MLOps best practices, including robust data validation with Pydantic and a comprehensive, layered testing strategy.

## Project Overview

The API exposes a `/predict` endpoint that accepts customer data, feeds it to a pre-trained scikit-learn pipeline, and returns a churn prediction along with the associated probabilities.

The key highlight is the multi-layered test suite, which is structured to ensure code quality, reliability, and maintainability at every level of the application stack.

## Project Structure

The project is organized into a clear and modular structure:

```
churn_classification_app_unittest_training1/
├── model_store/
│   └── churn_prediction_model_v1.joblib  # Pre-trained model artifact
├── src/
│   └── config.py                         # Centralized configuration
├── tests/
│   ├── unit/
│   │   └── test_api_unit.py              # Tests Pydantic models in isolation
│   ├── integration/
│   │   └── test_api_integration.py       # Tests API interaction with the real model
│   ├── functional/
│   │   └── test_api_functional.py        # Tests API logic with a mocked model
│   └── e2e/
│       └── test_e2e.py                   # Tests the live, containerized application
├── app.py                                # FastAPI application logic
├── Dockerfile                            # Instructions to build the Docker image
└── requirements.txt                      # Project dependencies
```

## Key Concepts Demonstrated

*   **FastAPI**: For building the high-performance, asynchronous API.
*   **Pydantic**: For robust, type-hint-based data validation and serialization at the API boundary.
*   **Docker**: For containerizing the application, its dependencies, and the ML model for consistent and reproducible deployments.
*   **Layered Testing Strategy**: The project implements a full spectrum of tests, reflecting the "Testing Pyramid":
    *   **Unit Tests**: Fast tests that verify the smallest piece of the API—the Pydantic request model—in complete isolation.
    *   **Integration Tests**: Verifies the "seam" between the API layer and the actual, loaded machine learning model to ensure they are compatible.
    *   **Functional Tests**: Checks the API's logic (routing, error handling, response formatting) by replacing the ML model with a mock, allowing for exhaustive testing of all API behaviors.
    *   **End-to-End (E2E) Tests**: The highest level of testing. It builds the Docker image, runs the container, and sends real HTTP requests to the live service to validate the entire system.

## Setup and Installation

### Prerequisites

1.  **Python 3.11+**
2.  **Docker Desktop**: Required for running the end-to-end tests.
3.  **Pre-trained Model**: This API requires a pre-trained model file (`churn_prediction_model_v1.joblib`). Ensure this file is present in the `model_store/` directory. It can be generated by running the associated training pipeline project.

### Installation Steps

1.  **Clone the repository:**
    ```bash
    git clone <repository-url>
    cd churn_classification_app_unittest_training1
    ```

2.  **Create and activate a virtual environment (recommended):**
    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows, use `venv\Scripts\activate`
    ```

3.  **Install the dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

## How to Run

### Running the API Locally

To run the FastAPI server locally for development, use `uvicorn`:

```bash
uvicorn app:app --reload
```

The API will be available at `http://127.0.0.1:8000`. You can access the interactive documentation (Swagger UI) at `http://127.0.0.1:8000/docs`.

### Running the Tests

The project uses Python's `unittest` framework. You can run all tests using the `discover` command from the project's root directory.

**Run all tests (excluding E2E, which requires Docker):**
```bash
python -m unittest discover -s tests -p "test_api_*.py" -v
```

**Run a specific type of test:**

*   **Unit Tests:**
    ```bash
    python -m unittest tests/unit/test_api_unit.py -v
    ```
*   **Integration Tests:**
    ```bash
    python -m unittest tests/integration/test_api_integration.py -v
    ```
*   **Functional Tests:**
    ```bash
    python -m unittest tests/functional/test_api_functional.py -v
    ```

*   **End-to-End Test (Requires Docker to be running):**
    ```bash
    python -m unittest tests/e2e/test_e2e.py -v
    ```

## API Endpoint

### `POST /predict`

This endpoint accepts customer data and returns a churn prediction.

**Request Body:**

```json
{
  "tenure": 1,
  "MonthlyCharges": 29.85,
  "TotalCharges": 29.85,
  "gender": "Female",
  "SeniorCitizen": 0,
  "Partner": "Yes",
  "Dependents": "No",
  "PhoneService": "No",
  "MultipleLines": "No phone service",
  "InternetService": "DSL",
  "OnlineSecurity": "No",
  "OnlineBackup": "Yes",
  "DeviceProtection": "No",
  "TechSupport": "No",
  "StreamingTV": "No",
  "StreamingMovies": "No",
  "Contract": "Month-to-month",
  "PaperlessBilling": "Yes",
  "PaymentMethod": "Electronic check"
}
```

**Success Response (200 OK):**

```json
{
  "prediction": "No Churn",
  "churn_probability": 0.0783,
  "no_churn_probability": 0.9217,
  "probabilities": {
    "No Churn": 0.9217,
    "Churn": 0.0783
  }
}
```

---

This project serves as a robust template for building, testing, and deploying ML-powered APIs.

